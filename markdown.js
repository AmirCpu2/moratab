(function(a){typeof exports=="object"&&typeof module=="object"?a(require("../../lib/codemirror",require("../xml/xml"))):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../xml/xml"],a):a(CodeMirror)})(function(a){"use strict",a.defineMode("markdown",function(b,c){function E(a,b,c){return b.f=b.inline=c,c(a,b)}function F(a,b,c){return b.f=b.block=c,c(a,b)}function G(a){return a.linkTitle=!1,a.em=!1,a.strong=!1,a.quote=0,!d&&a.f==I&&(a.f=M,a.block=H),a.trailingSpace=0,a.trailingSpaceNewLine=!1,a.thisLineHasContent=!1,null}function H(a,b){var d=a.sol(),e=b.list!==!1;b.list!==!1&&b.indentationDiff>=0?(b.indentationDiff<4&&(b.indentation-=b.indentationDiff),b.list=null):b.list!==!1&&b.indentation>0?(b.list=null,b.listDepth=Math.floor(b.indentation/4)):b.list!==!1&&(b.list=!1,b.listDepth=0);var f=null;if(b.indentationDiff>=4)return b.indentation-=4,a.skipToEnd(),j;if(a.eatSpace())return null;if(f=a.match(B))return b.header=f[0].length<=6?f[0].length:6,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,K(b);if(b.prevLineHasContent&&(f=a.match(C)))return b.header=f[0].charAt(0)=="="?1:2,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,K(b);if(a.eat(">"))return b.indentation++,b.quote=d?1:b.quote+1,c.highlightFormatting&&(b.formatting="quote"),a.eatSpace(),K(b);if(a.peek()==="[")return E(a,b,Q);if(a.match(x,!0))return o;if((!b.prevLineHasContent||e)&&(a.match(y,!1)||a.match(z,!1))){var h=null;return a.match(y,!0)?h="ul":(a.match(z,!0),h="ol"),b.indentation+=4,b.list=!0,b.listDepth++,c.taskLists&&a.match(A,!1)&&(b.taskList=!0),b.f=b.inline,c.highlightFormatting&&(b.formatting=["list","list-"+h]),K(b)}return c.fencedCodeBlocks&&a.match(/^```([\w+#]*)/,!0)?(b.localMode=g(RegExp.$1),b.localMode&&(b.localState=b.localMode.startState()),F(a,b,J),c.highlightFormatting&&(b.formatting="code-block"),b.code=!0,K(b)):E(a,b,b.inline)}function I(a,b){var c=e.token(a,b.htmlState);if(d&&!b.htmlState.tagName&&!b.htmlState.context||b.md_inside&&a.current().indexOf(">")>-1)b.f=M,b.block=H,b.htmlState=null;return c}function J(a,b){if(a.sol()&&a.match(/^```/,!0)){b.localMode=b.localState=null,b.f=M,b.block=H,c.highlightFormatting&&(b.formatting="code-block"),b.code=!0;var d=K(b);return b.code=!1,d}return b.localMode?b.localMode.token(a,b.localState):(a.skipToEnd(),j)}function K(a){var b=[];if(a.formatting){b.push(q),typeof a.formatting=="string"&&(a.formatting=[a.formatting]);for(var d=0;d<a.formatting.length;d++)b.push(q+"-"+a.formatting[d]),a.formatting[d]==="header"&&b.push(q+"-"+a.formatting[d]+a.header),a.formatting[d]==="quote"&&(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(q+"-"+a.formatting[d]+"-"+a.quote):b.push("error"))}if(a.taskOpen)return b.push("meta"),b.length?b.join(" "):null;if(a.taskClosed)return b.push("property"),b.length?b.join(" "):null;if(a.linkHref)return b.push(u),b.length?b.join(" "):null;a.strong&&b.push(w),a.em&&b.push(v),a.linkText&&b.push(t),a.code&&b.push(j),a.header&&(b.push(i),b.push(i+a.header)),a.quote&&(b.push(k),!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(k+"-"+a.quote):b.push(k+"-"+c.maxBlockquoteDepth));if(a.list!==!1){var e=(a.listDepth-1)%3;e?e===1?b.push(m):b.push(n):b.push(l)}return a.trailingSpaceNewLine?b.push("trailing-space-new-line"):a.trailingSpace&&b.push("trailing-space-"+(a.trailingSpace%2?"a":"b")),b.length?b.join(" "):null}function L(a,b){return a.match(D,!0)?K(b):undefined}function M(b,d){var f=d.text(b,d);if(typeof f!="undefined")return f;if(d.list)return d.list=null,K(d);if(d.taskList){var g=b.match(A,!0)[1]!=="x";return g?d.taskOpen=!0:d.taskClosed=!0,c.highlightFormatting&&(d.formatting="task"),d.taskList=!1,K(d)}d.taskOpen=!1,d.taskClosed=!1;if(d.header&&b.match(/^#+$/,!0))return c.highlightFormatting&&(d.formatting="header"),K(d);var i=b.sol(),j=b.next();if(d.escape)return d.escape=!1,K(d);if(j==="\\")return c.highlightFormatting&&(d.formatting="escape"),d.escape=!0,K(d);if(d.linkTitle){d.linkTitle=!1;var k=j;j==="("&&(k=")"),k=(k+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var l="^\\s*(?:[^"+k+"\\\\]+|\\\\\\\\|\\\\.)"+k;if(b.match(new RegExp(l),!0))return u}if(j==="`"){var m=d.formatting;c.highlightFormatting&&(d.formatting="code");var n=K(d),o=b.pos;b.eatWhile("`");var q=1+b.pos-o;return d.code?q===h?(d.code=!1,n):(d.formatting=m,K(d)):(h=q,d.code=!0,K(d))}if(d.code)return K(d);if(j==="!"&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return b.match(/\[[^\]]*\]/),d.inline=d.f=O,p;if(j==="["&&b.match(/.*\](\(| ?\[)/,!1))return d.linkText=!0,c.highlightFormatting&&(d.formatting="link"),K(d);if(j==="]"&&d.linkText){c.highlightFormatting&&(d.formatting="link");var t=K(d);return d.linkText=!1,d.inline=d.f=O,t}if(j==="<"&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=N,c.highlightFormatting&&(d.formatting="link");var t=K(d);return t?t+=" ":t="",t+r}if(j==="<"&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=N,c.highlightFormatting&&(d.formatting="link");var t=K(d);return t?t+=" ":t="",t+s}if(j==="<"&&b.match(/^\w/,!1)){if(b.string.indexOf(">")!=-1){var v=b.string.substring(1,b.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(v)&&(d.md_inside=!0)}return b.backUp(1),d.htmlState=a.startState(e),F(b,d,I)}if(j==="<"&&b.match(/^\/\w*?>/))return d.md_inside=!1,"tag";var w=!1;if(!c.underscoresBreakWords&&j==="_"&&b.peek()!=="_"&&b.match(/(\w)/,!1)){var x=b.pos-2;if(x>=0){var y=b.string.charAt(x);y!=="_"&&y.match(/(\w)/,!1)&&(w=!0)}}if(j==="*"||j==="_"&&!w){if(!i||b.peek()!==" "){if(d.strong===j&&b.eat(j)){c.highlightFormatting&&(d.formatting="strong");var n=K(d);return d.strong=!1,n}if(!d.strong&&b.eat(j))return d.strong=j,c.highlightFormatting&&(d.formatting="strong"),K(d);if(d.em===j){c.highlightFormatting&&(d.formatting="em");var n=K(d);return d.em=!1,n}if(!d.em)return d.em=j,c.highlightFormatting&&(d.formatting="em"),K(d)}}else if(j===" ")if(b.eat("*")||b.eat("_")){if(b.peek()===" ")return K(d);b.backUp(1)}return j===" "&&(b.match(/ +$/,!1)?d.trailingSpace++:d.trailingSpace&&(d.trailingSpaceNewLine=!0)),K(d)}function N(a,b){var d=a.next();if(d===">"){b.f=b.inline=M,c.highlightFormatting&&(b.formatting="link");var e=K(b);return e?e+=" ":e="",e+r}return a.match(/^[^>]+/,!0),r}function O(a,b){if(a.eatSpace())return null;var d=a.next();return d==="("||d==="["?(b.f=b.inline=P(d==="("?")":"]"),c.highlightFormatting&&(b.formatting="link-string"),b.linkHref=!0,K(b)):"error"}function P(a){return function(b,d){var e=b.next();if(e===a){d.f=d.inline=M,c.highlightFormatting&&(d.formatting="link-string");var f=K(d);return d.linkHref=!1,f}return b.match(U(a),!0)&&b.backUp(1),d.linkHref=!0,K(d)}}function Q(a,b){return a.match(/^[^\]]*\]:/,!1)?(b.f=R,a.next(),c.highlightFormatting&&(b.formatting="link"),b.linkText=!0,K(b)):E(a,b,M)}function R(a,b){if(a.match(/^\]:/,!0)){b.f=b.inline=S,c.highlightFormatting&&(b.formatting="link");var d=K(b);return b.linkText=!1,d}return a.match(/^[^\]]+/,!0),t}function S(a,b){return a.eatSpace()?null:(a.match(/^[^\s]+/,!0),a.peek()===undefined?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),b.f=b.inline=M,u)}function U(a){return T[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),T[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")")),T[a]}var d=a.modes.hasOwnProperty("xml"),e=a.getMode(b,d?{name:"xml",htmlMode:!0}:"text/plain"),f={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},g=function(){var c,d={},e={},g,h=[];for(var i in a.modes)a.modes.propertyIsEnumerable(i)&&h.push(i);for(c=0;c<h.length;c++)d[h[c]]=h[c];var j=[];for(var i in a.mimeModes)a.mimeModes.propertyIsEnumerable(i)&&j.push({mime:i,mode:a.mimeModes[i]});for(c=0;c<j.length;c++)g=j[c].mime,e[g]=j[c].mime;for(var k in f)if(f[k]in d||f[k]in e)d[k]=f[k];return function(c){return d[c]?a.getMode(b,d[c]):null}}();c.highlightFormatting===undefined&&(c.highlightFormatting=!1),c.maxBlockquoteDepth===undefined&&(c.maxBlockquoteDepth=0),c.underscoresBreakWords===undefined&&(c.underscoresBreakWords=!0),c.fencedCodeBlocks===undefined&&(c.fencedCodeBlocks=!1),c.taskLists===undefined&&(c.taskLists=!1);var h=0,i="header",j="comment",k="quote",l="variable-2",m="variable-3",n="keyword",o="hr",p="tag",q="formatting",r="link",s="link",t="link",u="string",v="em",w="strong",x=/^([*\-=_])(?:\s*\1){2,}\s*$/,y=/^[*\-+]\s+/,z=/^[0-9]+\.\s+/,A=/^\[(x| )\](?=\s)/,B=/^#+/,C=/^(?:\={1,}|-{1,})$/,D=/^[^#!\[\]*_\\<>` "'(]+/,T=[],V={startState:function(){return{f:H,prevLineHasContent:!1,thisLineHasContent:!1,block:H,htmlState:null,indentation:0,inline:M,text:L,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(b){return{f:b.f,prevLineHasContent:b.prevLineHasContent,thisLineHasContent:b.thisLineHasContent,block:b.block,htmlState:b.htmlState&&a.copyState(e,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,escape:!1,formatting:!1,linkTitle:b.linkTitle,em:b.em,strong:b.strong,header:b.header,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside}},token:function(a,b){b.formatting=!1;if(a.sol()){var c=a.match(/^\s*$/,!0)||b.header;b.header=0;if(c)return b.prevLineHasContent=!1,G(b);b.prevLineHasContent=b.thisLineHasContent,b.thisLineHasContent=!0,b.escape=!1,b.taskList=!1,b.code=!1,b.trailingSpace=0,b.trailingSpaceNewLine=!1,b.f=b.block;var d=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,e=Math.floor((d-b.indentation)/4)*4;e>4&&(e=4);var f=b.indentation+e;b.indentationDiff=f-b.indentation,b.indentation=f;if(d>0)return null}return b.f(a,b)},innerMode:function(a){return a.block==I?{state:a.htmlState,mode:e}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,mode:V}},blankLine:G,getType:K};return V},"xml"),a.defineMIME("text/x-markdown","markdown")});